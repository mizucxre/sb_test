SEABLUU ‚Äî Telegram-–±–æ—Ç, –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Neon
0) –û —á—ë–º –ø—Ä–æ–µ–∫—Ç

SEABLUU ‚Äî —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –≤—ã–∫—É–ø–∞ –º–µ—Ä—á–∞ –∏–∑ –ö–∏—Ç–∞—è/–ö–æ—Ä–µ–∏ + –ø—Ä–æ—Å—Ç–∞—è –≤–µ–±-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏.
–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ Google Sheets. –°–µ–π—á–∞—Å –ø–µ—Ä–µ–≤–æ–¥–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ PostgreSQL (Neon), —Å–æ—Ö—Ä–∞–Ω—è—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

1) –ö–∞–∫ –±—ã–ª–æ –†–ê–ù–¨–®–ï (–∏—Å—Ç–æ—Ä–∏—è)

–ë–æ—Ç –≤ Telegram

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è order_id –≤–∏–¥–∞ CN-12345/KR-12345.

–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–∞—Ö).

–•—Ä–∞–Ω–∏–ª–∏—â–µ ‚Äî —Ç–æ–ª—å–∫–æ Google Sheets

–õ–∏—Å—Ç—ã: orders, clients, addresses, admins, subscriptions, –∏–Ω–æ–≥–¥–∞ news.

–ë–æ—Ç —á–∏—Ç–∞–ª/–ø–∏—Å–∞–ª –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–∞–±–ª–∏—Ü—É —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.

–•–æ—Å—Ç–∏–Ω–≥

Koyeb (Docker-–æ–±—Ä–∞–∑), –∑–∞–ø—É—Å–∫ Uvicorn c –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º FastAPI.

–ù–µ –±—ã–ª–æ ¬´–≤–µ–±-–∞–¥–º–∏–Ω–∫–∏¬ª, –≤—Å—ë –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —á–µ—Ä–µ–∑ —Å–∞–º—É —Ç–∞–±–ª–∏—Ü—É.

–ü–ª—é—Å—ã: –ø—Ä–æ—Å—Ç–æ –∏ –±—ã—Å—Ç—Ä–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç. –ú–∏–Ω—É—Å—ã: —Å–∫–æ—Ä–æ—Å—Ç—å/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å GSheets, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∞–¥–º–∏–Ω–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π.

2) –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–° (—Ü–µ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å)
2.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–µ–±-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å /admin (–ø–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –∫–ª–∏–µ–Ω—Ç—ã/–∞–¥—Ä–µ—Å–∞, –Ω–æ–≤–æ—Å—Ç–∏, —á–∞—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤).

–ü–æ—è–≤–∏–ª–∞—Å—å –ë–î Neon (PostgreSQL) ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ GSheets –≤ –ë–î –ø–æ —ç—Ç–∞–ø–∞–º.

–í –∫–æ–¥–µ –≤–≤–µ–¥—ë–Ω —Å–ª–æ–π-–∞–¥–∞–ø—Ç–µ—Ä sheets.py: –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ API –¥–ª—è –∞–¥–º–∏–Ω–∫–∏/–±–æ—Ç–∞, –∞ ¬´–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –≤ Sheets –∏–ª–∏ –≤ Neon ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ.

2.2 –ü–µ—Ä–µ—Ö–æ–¥ (—Ñ–∞–∑—ã)

–§–∞–∑–∞ A ‚Äî –≥–∏–±—Ä–∏–¥ (—Ç–µ–∫—É—â–∞—è)

–ò—Å—Ç–∏–Ω–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º (orders): –ø–æ–∫–∞ GSheets.

–ß–∞—Ç/—Å–ª—É–∂–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/–∞–¥–º–∏–Ω—ã: –≤ Neon (—Å fallback –Ω–∞ Sheets –ø—Ä–∏ –ø—É—Å—Ç–æ–π –ë–î).

–í–µ–±-–∞–¥–º–∏–Ω–∫–∞ –ø–∏—à–µ—Ç —Å—Ç–∞—Ç—É—Å—ã —Ç—É–¥–∞ –∂–µ, –≥–¥–µ —Å–µ–π—á–∞—Å ¬´–∏—Å—Ç–∏–Ω–∞¬ª (GSheets).

–§–∞–∑–∞ B ‚Äî –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–Ω–æ—Å–∏–º orders, clients, addresses, subscriptions –≤ Neon.

–í sheets.py –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ PostgreSQL (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º repo_pg.py/db_pg.py –Ω–∞–ø—Ä—è–º—É—é).

–í–µ–±-–∞–¥–º–∏–Ω–∫–∞ –∏ –±–æ—Ç –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç Google Sheets.

3) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
Telegram ‚Üî FastAPI (webhook) ‚îê
                             ‚îú‚îÄ‚îÄ sheets.py (–µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –¥–∞–Ω–Ω—ã–º)
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (/admin) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚îú‚îÄ GSheets  (–§–∞–∑–∞ A: –∏—Å—Ç–∏–Ω–∞ –ø–æ orders)
            ‚îî‚îÄ Neon PG  (—á–∞—Ç, –∞–¥–º–∏–Ω—ã, –¥–∞–ª–µ–µ –≤—Å—ë)

4) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

BOT_TOKEN ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ Telegram

WEBHOOK_URL ‚Äî URL –≤–µ–±—Ö—É–∫–∞ Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://<app>.koyeb.app/telegram)

PUBLIC_URL ‚Äî –ø—É–±–ª–∏—á–Ω–∞—è –±–∞–∑–∞ URL —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://<app>.koyeb.app)

PORT ‚Äî –ø–æ—Ä—Ç –¥–ª—è Uvicorn (Koyeb –∑–∞–¥–∞—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

DATABASE_URL ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon –≤ —Ñ–æ—Ä–º–∞—Ç–µ
postgresql://USER:PASSWORD@HOST:PORT/DB?sslmode=require

–î–ª—è Google Sheets:

GOOGLE_CREDENTIALS_JSON ‚Äî JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É)

GOOGLE_SHEETS_ID ‚Äî id —Ç–∞–±–ª–∏—Ü—ã

–î–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É:

ADMIN_LOGIN ‚Äî –ª–æ–≥–∏–Ω –≤–ª–∞–¥–µ–ª—å—Ü–∞ (owner), –Ω–∞–ø—Ä. mizu299

ADMIN_PASSWORD ‚Äî –ø–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞

ADMIN_SECRET ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Å—Å–∏–π (–ª—é–±–æ–π –Ω–∞–¥—ë–∂–Ω—ã–π)

ADMIN_AVATAR ‚Äî (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) URL –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞

–ü—Ä–æ—á–µ–µ:

ADMIN_IDS ‚Äî —Å–ø–∏—Å–æ–∫ Telegram-ID –∞–¥–º–∏–Ω–æ–≤ –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —à—Ç—É–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

5) –°—Ö–µ–º–∞ –ë–î (Neon, —Ç–µ–∫—É—â–∞—è)

–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥ —Ç–µ–∫—É—â–∏–π –∫–æ–¥. –ò–º–µ–Ω–∞ –∏ —Ç–∏–ø—ã –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å.

-- —á–∞—Ç –∞–¥–º–∏–Ω–æ–≤
create table if not exists chat_messages (
  id bigserial primary key,
  created_at timestamptz default now(),
  sender text,
  avatar text,
  text text,
  ref text
);

-- –∞–¥–º–∏–Ω-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
create table if not exists admins (
  login text primary key,
  password_hash text,
  role text default 'admin',
  avatar text,
  created_at timestamptz default now()
);

-- –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∑–∞–∫–∞–∑—ã (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
create table if not exists subscriptions (
  user_id bigint,
  order_id text,
  last_status text,
  updated_at timestamptz default now(),
  primary key (user_id, order_id)
);

-- —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
create table if not exists clients (
  username text primary key,
  name text,
  phone text
);

create table if not exists addresses (
  username text primary key,
  address text,
  phone text
);

-- –∑–∞–∫–∞–∑—ã (–∫ –º–∏–≥—Ä–∞—Ü–∏–∏)
create table if not exists orders (
  order_id text primary key,
  origin text,
  status text,
  clients text,
  note text,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);

6) –ú–∏–≥—Ä–∞—Ü–∏—è —Å Google Sheets –≤ Neon
–í–∞—Ä–∏–∞–Ω—Ç 1 (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –∏–∑ Koyeb)

–í–æ –≤–∫–ª–∞–¥–∫–µ Command —É —Å–µ—Ä–≤–∏—Å–∞ –≤–∫–ª—é—á–∏ Override –∏ –ø–æ—Å—Ç–∞–≤—å:

bash -lc "python app/migrate_gsheets_to_neon.py && exec uvicorn app.webhook:app --host 0.0.0.0 --port $PORT"


–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∏—Ä—É–µ—Ç –ª–∏—Å—Ç—ã (clients, addresses, orders, subscriptions) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –∑–∞—Ç–µ–º —Å—Ç–∞—Ä—Ç—É–µ—Ç API.

–ï—Å–ª–∏ —É–≤–∏–¥–∏—à—å –æ—à–∏–±–∫–∏ –≤–∏–¥–∞ UndefinedColumn: created_at, —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≥–æ–Ω—è–π ALTER TABLE –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ ¬´–°—Ö–µ–º–∞ –ë–î¬ª.

–í–∞—Ä–∏–∞–Ω—Ç 2 (–ª–æ–∫–∞–ª—å–Ω–æ)

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π JSON –∫–ª—é—á–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ GOOGLE_SHEETS_ID –≤ .env.

–ó–∞–ø—É—Å—Ç–∏ python app/migrate_gsheets_to_neon.py.

–ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø–∏—Å–∏ –≤ Neon, –∑–∞—Ç–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ Koyeb –æ–±—ã—á–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

7) –î–µ–ø–ª–æ–π –Ω–∞ Koyeb

Docker/Buildpacks ‚Üí Uvicorn:

uvicorn app.webhook:app --host 0.0.0.0 --port $PORT


Env –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ Environment variables and files.
–ï—Å–ª–∏ –¥–µ–ª–∞–µ—à—å –º–∏–≥—Ä–∞—Ü–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Äî —Å–º. ¬´–í–∞—Ä–∏–∞–Ω—Ç 1¬ª –≤—ã—à–µ.

8) –í–µ–±-–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ú–∞—Ä—à—Ä—É—Ç: GET /admin
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ ‚Äî —Ñ–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞. –í–ª–∞–¥–µ–ª–µ—Ü —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ ADMIN_LOGIN/ADMIN_PASSWORD.

–û—Å–Ω–æ–≤–Ω—ã–µ API

POST /admin/api/login ‚Äî –≤—Ö–æ–¥ (JSON {login, password}), —Å—Ç–∞–≤–∏—Ç cookie adm_session.

POST /admin/api/logout ‚Äî –≤—ã—Ö–æ–¥.

GET /admin/api/search?q= ‚Äî –ø–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤:

–ø—É—Å—Ç–æ–π q ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–∫–∞–∑–æ–≤,

CN-12345 ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–∫–∞–∑,

@username –ª–∏–±–æ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí –≤—ã–±–æ—Ä–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç—É.

POST /admin/api/status ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞:
{ "order_id": "CN-12345", "status": "üõí –≤—ã–∫—É–ø–ª–µ–Ω" }
–∏–ª–∏ { "order_id": "CN-12345", "pick_index": 0 } (–≤—ã–±–æ—Ä –∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤).

POST /admin/api/status/bulk ‚Äî –ø–∞–∫–µ—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:
{ "order_ids": ["CN-1","CN-2"], "status": "..." }

GET /admin/api/clients ‚Äî –∫–ª–∏–µ–Ω—Ç—ã (+ –∏—Ö –∑–∞–∫–∞–∑—ã).

GET /admin/api/addresses?q= ‚Äî –∞–¥—Ä–µ—Å–∞ (–ø–æ–∏—Å–∫).

GET /admin/api/admins ‚Äî —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏).

POST /admin/api/admins ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞ (—Ç–æ–ª—å–∫–æ owner).

POST /admin/api/admins/avatar ‚Äî —Å–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –∞–≤–∞—Ç–∞—Ä.

GET /admin/api/chat?since_id=0 ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞.

POST /admin/api/chat ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç.

GET /admin/api/news ‚Äî –ø–æ—Å—Ç—ã/–æ–±—ä—è–≤–ª–µ–Ω–∏—è.

POST /admin/api/news/publish ‚Äî –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ owner).

–ù–∞ –§–∞–∑–µ A CRUD –ø–æ –∑–∞–∫–∞–∑–∞–º –∏–¥—ë—Ç –≤ Google Sheets (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã), –∞ —á–∞—Ç/–∞–¥–º–∏–Ω—ã ‚Äî –≤ Neon. –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –≤—Å—ë –≤ Neon.

9) –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

ModuleNotFoundError: No module named 'psycopg'
‚Üí –í requirements.txt –¥–æ–±–∞–≤—å psycopg[binary].

asyncpg.exceptions.ClientConfigurationError: invalid DSN
‚Üí –ü—Ä–æ–≤–µ—Ä—å DATABASE_URL (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å postgresql://... –∏ sslmode=require).

UndefinedColumnError: column "created_at" ...
‚Üí –ü—Ä–æ–≥–æ–Ω–∏ SQL –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ ¬´–°—Ö–µ–º–∞ –ë–î¬ª (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è orders/admins).

InvalidDatetimeFormat: "created_at"
‚Üí –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π —Å—Ç—Ä–æ–∫—É "created_at" –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ; –ª–∏–±–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å DEFAULT now().

–í –∞–¥–º–∏–Ω–∫–µ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
‚Üí –ù–∞ –§–∞–∑–µ A –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ GSheets: –ø—Ä–æ–≤–µ—Ä—å GOOGLE_CREDENTIALS_JSON, GOOGLE_SHEETS_ID, –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å-–∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –Ω–∞–ª–∏—á–∏–µ –ª–∏—Å—Ç–∞ orders.
‚Üí –£–±–µ–¥–∏—Å—å, —á—Ç–æ sheets.py –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã (list_recent_orders).

–ù–µ –ø—É—Å–∫–∞–µ—Ç –≤ –∞–¥–º–∏–Ω–∫—É (401/¬´–Ω–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å¬ª)
‚Üí –ü—Ä–æ–≤–µ—Ä—å ADMIN_LOGIN / ADMIN_PASSWORD / ADMIN_SECRET –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å. –í–ª–∞–¥–µ–ª–µ—Ü —Å–æ–∑–¥–∞—ë—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ.

10) –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –≤–∫–ª—é—á–µ–Ω–∏–µ–º –§–∞–∑—ã B (–ø–æ–ª–Ω–∞—è Neon)

–ü—Ä–æ–≥–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ migrate_gsheets_to_neon.py –±–µ–∑ –æ—à–∏–±–æ–∫.

–í Neon —Ç–∞–±–ª–∏—Ü—ã orders/clients/addresses/subscriptions –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.

–í sheets.py –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å orders –Ω–∞ PG-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

–ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –∞–¥–º–∏–Ω–∫–µ: –ø–æ–∏—Å–∫, —Å—Ç–∞—Ç—É—Å, –∫–ª–∏–µ–Ω—Ç—ã/–∞–¥—Ä–µ—Å–∞, —á–∞—Ç, –Ω–æ–≤–æ—Å—Ç–∏.

–û—Ç–∫–ª—é—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –±–æ—Ç–∞ –∫ Google Sheets (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ read-only –Ω–∞ –≤—Ä–µ–º—è).

11) –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
python -m pip install -r requirements.txt

# .env (–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
export BOT_TOKEN=...
export WEBHOOK_URL=https://<app>.koyeb.app/telegram
export PUBLIC_URL=https://<app>.koyeb.app
export DATABASE_URL=postgresql://USER:PASSWORD@HOST:5432/DB?sslmode=require
export ADMIN_LOGIN=admin
export ADMIN_PASSWORD=admin
export ADMIN_SECRET=supersecret

# –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å GSheets –Ω–∞ –§–∞–∑–µ A:
export GOOGLE_SHEETS_ID=...
export GOOGLE_CREDENTIALS_JSON='{"type":"service_account", ...}'

# –∑–∞–ø—É—Å–∫
uvicorn app.webhook:app --host 0.0.0.0 --port 8000
